#######################################
#                                     #
#              VARIABLES              #
#                                     #
#######################################
action=""

#######################################
#                                     #
#              FUNCTIONS              #
#                                     #
#######################################
function page_action
{
	echo $1
}

#######################################
#                                     #
#           PAGE CONTENT              #
#                                     #
#######################################
heading "Please Wait" "Logging In"

cookiePath="$scriptPath""/resources/cookie.txt"
touch $cookiePath

#LETS GET THE INITIAL COOKIES NEEDED
loginpage=`curl -s -c $cookiePath -A "Mozilla/5.0" "http://m.facebook.com"`

#LOGIN PARAMETERS
form_action=`echo "$loginpage" | tr '"' "\n" | grep "https://www.facebook.com/login.php"`
form_data=`echo "$loginpage" | sed -e 's/.*<form//' | sed -e 's/form>.*//' | tr '/>' "\n" | grep 'input ' | grep -v "email\|pass"`

#FUNCTION PARSES FORM DATA LIKE HIDDEN INPUTS
function parse_form() {
	form_data="$1"
	params=""
	for (( i=1; i <= `echo "$form_data" | wc -l` ; i++ ))
	do
		name=`echo "$form_data" | sed -n "$i"p | tr ' ' "\n" | grep 'name' | cut -d '"' -f 2`
		value=`echo "$form_data" | sed -n "$i"p | tr ' ' "\n" | grep 'value' | cut -d '"' -f 2`
		params="$params$name=$value&"
	done
	echo "$params"
}

#LOGIN
params="email=$email&pass=$pass&"`parse_form "$form_data"`
logged_in=`curl -s -b $cookiePath -c $cookiePath -A "Mozilla/5.0" -d "$params" -L "$form_action"`
homepage=`curl -s -b $cookiePath -c $cookiePath -A "Mozilla/5.0" -L "http://m.facebook.com/profile.php"`

echo $homepage
